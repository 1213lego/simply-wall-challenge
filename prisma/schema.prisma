generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                String        @id @db.Uuid
  name              String        @db.VarChar(255)
  primaryIndustryId Int
  tradingItems      TradingItem[]

  @@map("companies")
}

model TradingItem {
  id                 BigInt            @id
  companyId          String            @db.Uuid
  exchangeSymbol     String            @db.VarChar(10)
  tickerSymbol       String            @db.VarChar(20)
  exchangeCountryIso String            @db.VarChar(2)
  company            Company           @relation(fields: [companyId], references: [id])
  historicalPrices   HistoricalPrice[]
  transactions       Transaction[]

  @@unique([exchangeSymbol, tickerSymbol])
  @@map("trading_items")
}

model HistoricalPrice {
  id                String      @id @default(uuid()) @db.Uuid
  tradingItemId     BigInt
  pricingDate       DateTime    @db.Timestamptz
  priceCloseAud     Decimal     @db.Decimal(18, 6)
  priceCloseUsd     Decimal     @db.Decimal(24, 12)
  sharesOutstanding BigInt?
  marketCap         Decimal?    @db.Decimal(32, 12)
  tradingItem       TradingItem @relation(fields: [tradingItemId], references: [id])

  @@unique([tradingItemId, pricingDate])
  @@index([tradingItemId, pricingDate(sort: Desc)])
  @@map("historical_prices")
}

model Portfolio {
  id           String        @id @default(uuid()) @db.Uuid
  name         String        @db.VarChar(255)
  transactions Transaction[]

  @@map("portfolios")
}

enum TransactionType {
  buy
  sell
}

model Transaction {
  id              String          @id @default(uuid()) @db.Uuid
  portfolioId     String          @db.Uuid
  tradingItemId   BigInt
  transactionDate DateTime        @db.Timestamptz
  transactionType TransactionType
  quantity        Decimal         @db.Decimal(18, 6)
  price           Decimal         @db.Decimal(18, 6)
  currency        String          @default("AUD") @db.VarChar(3)
  transactionCost Decimal         @default(0) @db.Decimal(18, 6)
  portfolio       Portfolio       @relation(fields: [portfolioId], references: [id])
  tradingItem     TradingItem     @relation(fields: [tradingItemId], references: [id])

  @@index([portfolioId, transactionDate(sort: Desc)])
  @@map("transactions")
}
